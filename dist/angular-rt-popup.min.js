var mod=angular.module("rt.popup",[]);mod.factory("Popup",["$window","$document","$timeout","$compile","$parse","$sce",function(a,b,c,d,e,f){function g(a){n&&!$.contains(n.el[0],a.target)&&h()}function h(){if(n){var a=n;n=null,c(function(){e(a.options.popupHidden)(a.scope),a.el.hide().remove(),b.off("click",g)})}}function i(a,b){for(var c in b)a[c]||(a[c]=b[c])}function j(a,b,d){i(d,{popupPlacement:"right",popupClass:"",popupShown:"",popupHidden:"",popupOverlap:5}),b.popupView=d.popupShow,b.content=f.trustAsHtml(d.popupHtml),b.hidePopover=h,c(function(){m(a,b,d)})}function k(c){var d=c[0].getBoundingClientRect();return{width:d.width||c.prop("offsetWidth"),height:d.height||c.prop("offsetHeight"),top:d.top+(a.pageYOffset||b[0].documentElement.scrollTop),left:d.left+(a.pageXOffset||b[0].documentElement.scrollLeft)}}function l(c,d,f,h,i){var j=null,l=null,m=null,n=k(d),o=i.popupPlacement,p=i.popupClass,r=a.innerHeight-2*q,s=i.popupOverlap;if("right"===o)m={top:n.top+n.height/2,left:n.left+n.width-s},j={top:m.top-f.height()/2,left:m.left},j.top=Math.max(q,j.top),l={top:m.top-j.top};else if("left"===o)m={top:n.top+n.height/2,left:n.left+s-2},j={top:m.top-f.height()/2,left:m.left-f.width()},j.top=Math.max(q,j.top),l={top:m.top-j.top};else if("bottom"===o)m={top:n.top+n.height,left:n.left+n.width/2},j={top:m.top-s,left:m.left-f.width()/2},j.left=Math.max(q,j.left),r-=j.top,l={left:m.left-j.left};else{if("top"!==o)throw new Error("Unsupported placement "+o);m={top:n.top-f.outerHeight(),left:n.left+n.width/2},j={top:m.top+s,left:m.left-f.width()/2},j.left=Math.max(q,j.left),r-=j.top,l={left:m.left-j.left}}f.removeClass("left right bottom top"),f.addClass(o),p&&f.addClass(p),f.css({top:j.top+"px",left:j.left+"px",display:"block",maxHeight:r});var t=f.find(".popover-title"),u=f.find(".popover-content"),v=f.find(".popover-footer");u.css({maxHeight:r-v.outerHeight()-t.outerHeight()-4,overflow:"auto"}),l&&h.css(l),f.removeClass("hide"),b.on("click",g),e(i.popupShown)(c)}function m(a,e,f){var g=null;g=e.popupView?d(o)(e):d(p)(e),n={el:g,options:f,scope:e};var h=b.find("body");h.append(g);var i=$("<div />",{"class":"arrow"});g.children(".arrow").remove(),g.append(i),e.popupView?e.$reposition=function(){c(function(){l(e,a,g,i,f)})}:c(function(){l(e,a,g,i,f)})}var n=null,o='<div class="popover"><div ng-include="popupView" onload="$reposition()"></div></div>',p='<div class="popover"><div ng-bind-html="content"></div></div>',q=10;return{show:j,close:h}}]),mod.directive("popupShow",["Popup","$parse","$timeout",function(a,b,c){return{restrict:"A",scope:!0,link:function(d,e,f){e.click(function(){c(function(){a.close();var c=b(f.popupIf||"true");c(d)&&a.show(e,d,f)})})}}}]),mod.directive("popupAutoShow",["Popup","$parse",function(a,b){return{restrict:"A",link:function(c,d,e){c.$watch(e.popupAutoShow,function(f){if(f){a.close();var g=b(e.popupIf||"true");g(c)&&a.show(d,c,e)}})}}}]),mod.directive("popupHtml",["Popup","$parse","$timeout",function(a,b,c){return{restrict:"A",scope:!0,link:function(d,e,f){e.click(function(){c(function(){a.close();var c=b(f.popupIf||"true");c(d)&&a.show(e,d,f)})})}}}]);